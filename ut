@Test
fun `handleViewQuery GetDidvView executes composable body`() {
    // ---------- given ----------
    val payload = JSONObject("""{"key":"value"}""")

    every { plugin.job } returns mockk(relaxed = true)
    every { plugin.additionalAnalyticsConfigProvider } returns mockk(relaxed = true)
    every { plugin.viewModelFactory.get() } returns mockk(relaxed = true)
    every { plugin.savedStateViewModelFactory } returns mockk(relaxed = true)

    every {
        plugin.FetchComposableView(
            messageName = any(),
            pluginName = any(),
            payload = any()
        )
    } returns mockk(relaxed = true)

    every {
        plugin.FetchComposableView(
            messageName = any(),
            pluginName = any()
        )
    } returns mockk(relaxed = true)

    // objectToJson 用到了
    mockkStatic(::objectToJson)
    every { objectToJson(any()) } returns "{}"

    val viewQuery = ViewQuery(
        messageName = Messages.GetDidvView.name,
        payload = payload
    )

    // ---------- when ----------
    val response = handler.handleViewQuery(viewQuery)

    // ---------- then ----------
    // 关键：强制执行 lambda，触发 Sonar 覆盖
    when (response) {
        is ViewQueryResponse.ComposableViewQueryResponse -> {
            response.content.invoke()
        }
        else -> error("Unexpected response type")
    }

    // ---------- verify ----------
    verify {
        plugin.job?.cancel()
        plugin.additionalAnalyticsConfigProvider.setup(payload)
    }

    assert(handler.faceDetectCount == DidvJourneyUIHandler.FACE_DETECT_MAX_COUNT)
    assert(handler.faceDetectSpecialCount == DidvJourneyUIHandler.FACE_DETECT_3003_MAX_COUNT)
}
